<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bocadito Coin</title>
    <style>
        /* Estilos actualizados */
        :root {
            --azul: #2A5C82;
            --azul-claro: #E8F1F5;
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo-small {
            width: 80px;
            margin-right: 15px;
        }

        /* A√±adido estilo para bot√≥n eliminar */
        .btn-eliminar {
            background: #dc3545 !important;
            margin-left: 10px;
            padding: 5px 10px;
            width: auto;
        }
    </style>
</head>
<body>
    <!-- P√°gina Principal Actualizada -->
    <div id="mainPage" class="container" style="display: none;">
        <div class="header">
            <img src="logo.png" alt="Logo" class="logo-small">
            <div class="stats">
                <div class="stat-box">
                    <h3>Puntos</h3>
                    <p id="puntos">0</p>
                </div>
                <div class="stat-box">
                    <h3>Visitas</h3>
                    <p id="visitas">0</p>
                </div>
            </div>
        </div>

        <!-- Men√∫ Desplegable Mejorado -->
        <div id="menuDropdowns"></div>

        <!-- Carrito con Bot√≥n Eliminar -->
        <div class="carrito" id="carrito">
            <!-- Productos aparecer√°n aqu√≠ -->
        </div>

        <!-- Botones Actualizados -->
        <div class="botones-inferiores">
            <button onclick="window.location.href='tel:' + usuario?.Tel√©fono">üìû Llamar</button>
            <button onclick="enviarPedido()">‚úÖ Enviar Pedido</button>
            <button onclick="borrarCarrito()">üóëÔ∏è Vaciar Carrito</button>
        </div>
    </div>

    <script>
        // Configuraci√≥n Actualizada con Debug
        const BASEROW_CONFIG = {
            CLIENTES: {
                ID: 420235,
                CAMPOS: {
                    EMAIL: "Email",
                    CONTRASE√ëA: "Contrase√±a",
                    PUNTOS: "Puntos Cliente",
                    VISITAS: "N√∫mero de pedidos",
                    TELEFONO: "Tel√©fono"
                }
            },
            CARTA: {
                ID: 420254,
                CAMPOS: {
                    NOMBRE: "Nombre",
                    TIPO: "Tipo",
                    PRECIO: "Precio normal ‚Ç¨",
                    ID: "id"
                }
            },
            TOKEN: 'TU_TOKEN_AQUI'
        };

        async function cargarMenu() {
            try {
                console.log("[DEBUG] Cargando men√∫...");
                const response = await axios.get(
                    `https://api.baserow.io/api/database/rows/table/${BASEROW_CONFIG.CARTA.ID}/`, 
                    {
                        params: {
                            user_field_names: true,
                            include: [
                                BASEROW_CONFIG.CARTA.CAMPOS.ID,
                                BASEROW_CONFIG.CARTA.CAMPOS.NOMBRE,
                                BASEROW_CONFIG.CARTA.CAMPOS.TIPO,
                                BASEROW_CONFIG.CARTA.CAMPOS.PRECIO
                            ]
                        },
                        headers: {
                            Authorization: `Token ${BASEROW_CONFIG.TOKEN}`
                        }
                    }
                );

                console.log("[DEBUG] Respuesta men√∫:", response.data);
                menuData = groupBy(response.data.results, BASEROW_CONFIG.CARTA.CAMPOS.TIPO);
                generarDropdowns();
            } catch (error) {
                console.error("[ERROR] Cargando men√∫:", error);
                alert('Error cargando el men√∫. Por favor recarga la p√°gina.');
            }
        }

        function generarDropdowns() {
            const contenedor = document.getElementById('menuDropdowns');
            contenedor.innerHTML = '';

            for (const categoria in menuData) {
                const dropdownHTML = `
                    <div class="dropdown">
                        <button class="dropdown-btn">${categoria}</button>
                        <div class="dropdown-content">
                            ${menuData[categoria].map(plato => `
                                <div class="producto" onclick="agregarAlCarrito(${plato[BASEROW_CONFIG.CARTA.CAMPOS.ID]})">
                                    ${plato[BASEROW_CONFIG.CARTA.CAMPOS.NOMBRE]} - 
                                    ${plato[BASEROW_CONFIG.CARTA.CAMPOS.PRECIO]}‚Ç¨
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                contenedor.innerHTML += dropdownHTML;
            }

            // Activar dropdowns
            document.querySelectorAll('.dropdown-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const content = this.nextElementSibling;
                    content.style.display = content.style.display === 'block' ? 'none' : 'block';
                });
            });
        }

        // Funci√≥n para borrar productos individuales
        function eliminarProducto(platoId) {
            carrito = carrito.filter(item => item.plato.id !== platoId);
            actualizarCarrito();
        }

        // Funci√≥n para vaciar todo el carrito
        function borrarCarrito() {
            carrito = [];
            actualizarCarrito();
        }

        function actualizarCarrito() {
            const contenedor = document.getElementById('carrito');
            contenedor.innerHTML = carrito.map(item => `
                <div class="item-carrito">
                    <div>${item.plato.nombre}</div>
                    <div class="cantidad-control">
                        <button onclick="cambiarCantidad(${item.plato.id}, -1)">-</button>
                        <span>${item.cantidad}</span>
                        <button onclick="cambiarCantidad(${item.plato.id}, 1)">+</button>
                        <button class="btn-eliminar" onclick="eliminarProducto(${item.plato.id})">Eliminar</button>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
